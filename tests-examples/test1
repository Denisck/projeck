const { test, expect } = require('@playwright/test');

test('Automatyczne logowanie i testy strony z inventarzem', async ({ page }) => {
    await page.goto('https://www.saucedemo.com');
    await page.fill('#user-name', 'visual_user');
    await page.fill('#password', 'secret_sauce');
    await Promise.all([
        page.click('#login-button'),
        page.waitForNavigation()
    ]);

    await page.waitForSelector('.inventory_list');
    expect(page.url()).toContain('/inventory.html');

    test.describe('Testy strony z inventarzem na Saucedemo', () => {
        test('Powinny być wyświetlane produkty na stronie z inventarzem', async () => {
            await page.waitForSelector('.inventory_item');
            const productList = await page.$$('.inventory_item');
            expect(productList.length).toBeGreaterThan(0);
        });
        test('Powinno być możliwe dodanie produktu do koszyka', async () => {
            await page.click('.btn_primary');
            const cartBadge = await page.$('.shopping_cart_badge');
            if (cartBadge !== null) {
                expect(await cartBadge.textContent()).toBe('1');
            } else {
                console.error('Nie można znaleźć elementu koszyka');
            }
        });

        test('Powinno być możliwe usunięcie produktu z koszyka', async () => {
            await page.click('.btn_primary');
            await page.click('.btn_secondary');
            const cartBadge = await page.$('.shopping_cart_badge');
            if (cartBadge !== null) {
                expect(await cartBadge.textContent()).toBe('0');
            } else {
                console.error('Nie można znaleźć elementu koszyka');
            }
        });

        test('Powinno być możliwe przejście do strony szczegółów produktu', async () => {
            await page.click('.inventory_item:nth-child(1) a');
            expect(page.url()).toContain('/inventory-item.html');
        });
    });
});
